# SleepPosture - 睡姿分类项目：HIT cs practice project

## 项目概述

本项目是一个基于深度学习的睡姿分类系统，使用卷积神经网络(CNN)对睡眠姿态进行自动识别和分类。项目实现了对四种主要睡姿的分类：仰卧、俯卧、左侧卧和右侧卧。

## 项目结构

```
/home/jxchen/class/
├── README.md                 # 项目简介
├── train.py                  # 训练脚本
├── model/                    # 模型相关代码
│   ├── dataloader.py        # 数据加载器
│   └── model.py             # CNN模型定义
├── data/                     # 数据目录
├── saved_models/            # 保存的模型
│   └── final_model.pth      # 最终训练模型
└── .gitignore               # Git忽略文件
```

## 技术架构

### 1. 数据处理 (`model/dataloader.py`)

#### SleepPostureDataset类
- **功能**: 自定义PyTorch数据集类，用于加载和处理睡姿数据
- **输入格式**: 文本文件(.txt)，每个文件包含40x26的数据矩阵
- **数据维度**: 每帧数据为40行26列的二维数组
- **标签映射**: 
  - 0: 仰卧
  - 1: 俯卧  
  - 2: 左侧卧(合并弯腿和伸腿)
  - 3: 右侧卧(合并弯腿和伸腿)

#### 数据加载策略
项目支持三种不同的数据文件组织方式：

1. **29文件模式**: 按文件顺序分配标签
   - 前6个文件: 仰卧(标签0)
   - 第7-15个文件: 俯卧(标签1)
   - 第16-22个文件: 左侧卧(标签2)
   - 第23-29个文件: 右侧卧(标签3)

2. **21文件模式**: 按文件名结尾数字分配标签
   - 1-6结尾: 仰卧(标签0)
   - 7-9结尾: 俯卧(标签1)
   - 10-15结尾: 左侧卧(标签2)
   - 16-21结尾: 右侧卧(标签3)

3. **传统模式**: 基于文件名的原始标签映射

#### 数据预处理
- **归一化**: 将数据值归一化到[0,1]范围
- **维度扩展**: 添加通道维度，将(40,26)转换为(1,40,26)
- **数据验证**: 检查文件完整性，跳过空文件或无效数据

### 2. 模型架构 (`model/model.py`)

#### SleepPostureCNN类
基于卷积神经网络的睡姿分类模型，具有以下特点：

**网络结构**:
```
输入: (batch, 1, 40, 26)
├── Conv2d(1→32) + BatchNorm + ReLU + MaxPool → (batch, 32, 20, 13)
├── Conv2d(32→64) + BatchNorm + ReLU + MaxPool → (batch, 64, 10, 6)
├── Conv2d(64→128) + BatchNorm + ReLU + MaxPool → (batch, 128, 5, 3)
├── Flatten → (batch, 1920)
├── Linear(1920→512) + ReLU + Dropout(0.5)
├── Linear(512→128) + ReLU + Dropout(0.5)
└── Linear(128→4) → (batch, 4)
```

**关键特性**:
- **卷积层**: 3个卷积层，通道数递增(32→64→128)
- **批归一化**: 每个卷积层后添加BatchNorm，提高训练稳定性
- **池化操作**: MaxPool2d(2,2)，逐步降低空间维度
- **正则化**: Dropout(0.5)防止过拟合
- **激活函数**: ReLU激活函数

### 3. 训练流程 (`train.py`)

#### 训练配置
- **设备**: 自动检测CUDA可用性，优先使用GPU
- **批大小**: 32
- **学习率**: 0.001
- **优化器**: Adam优化器
- **损失函数**: CrossEntropyLoss
- **训练轮数**: 100个epoch
- **数据划分**: 80%训练集，20%验证集

#### 训练过程
1. **数据加载**: 使用自定义数据加载器加载训练和验证数据
2. **模型初始化**: 创建SleepPostureCNN模型实例
3. **训练循环**: 
   - 前向传播计算损失
   - 反向传播更新参数
   - 计算训练准确率
4. **验证评估**: 每个epoch后在验证集上评估模型性能
5. **模型保存**: 训练完成后保存最终模型状态

#### 输出信息
每个epoch输出以下信息：
- 训练损失(Train Loss)
- 训练准确率(Train Acc)
- 验证准确率(Val Acc)

## 数据格式说明

### 输入数据
- **文件格式**: .txt文本文件
- **数据结构**: 每行包含26个数值，共40行构成一帧
- **分隔符**: 支持逗号分隔或空格分隔
- **数据类型**: 浮点数

### 标签系统
项目采用4分类系统，将原始6类睡姿合并为4类：
- **仰卧**: 平躺姿势
- **俯卧**: 趴睡姿势  
- **左侧卧**: 左侧睡姿(合并弯腿和伸腿)
- **右侧卧**: 右侧睡姿(合并弯腿和伸腿)

## 模型性能

### 训练监控
- 实时显示训练损失和准确率
- 验证集准确率监控
- 模型状态自动保存

### 保存内容
最终模型保存包含：
- 模型参数状态字典
- 优化器状态字典
- 训练轮数信息
- 最终验证准确率
- 最终训练损失

## 使用方法

### 环境要求
```python
torch
numpy
pathlib
```

### 训练模型
```bash
python train.py
```

### 数据准备
1. 将睡姿数据文件放置在`/home/jxchen/class/data/text_data`目录下
2. 按用户文件夹组织数据
3. 确保数据文件格式正确(40行×26列)

## 项目特点

### 优势
1. **灵活的数据加载**: 支持多种文件组织方式
2. **鲁棒的数据处理**: 自动跳过无效文件，处理异常数据
3. **现代CNN架构**: 使用BatchNorm和Dropout提高性能
4. **完整的训练流程**: 包含验证、保存和监控功能
5. **可扩展设计**: 易于修改类别数量和网络结构

### 技术亮点
- 自适应数据加载策略
- 批归一化加速训练收敛
- Dropout正则化防止过拟合
- GPU加速训练
- 完整的模型状态保存

## 扩展建议

1. **数据增强**: 添加旋转、翻转等数据增强技术
2. **模型优化**: 尝试更深的网络或注意力机制
3. **超参数调优**: 使用网格搜索或贝叶斯优化
4. **可视化**: 添加训练曲线和混淆矩阵可视化
5. **部署**: 添加模型推理和实时预测功能

## 总结

本项目实现了一个完整的睡姿分类系统，从数据加载到模型训练都有完善的实现。代码结构清晰，具有良好的可维护性和扩展性，适合作为深度学习分类任务的参考实现。